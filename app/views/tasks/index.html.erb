<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-12">
      <div class="card shadow-sm border-0 animate__animated animate__fadeIn">
        <div class="card-body p-4">
          <h1 class="text-2xl font-bold text-gray-800 mb-4">Tarefas do Projeto: <%= @project.name %></h1>

          <%= link_to new_project_task_path(@project), class: "btn btn-primary mb-3 d-inline-flex align-items-center", aria: { label: "Criar nova tarefa" } do %>
            <i class="bi bi-plus-circle me-2"></i> Nova Tarefa
          <% end %>

          <% if flash[:alert] %>
            <div class="alert alert-danger" role="alert" aria-live="assertive">
              <%= flash[:alert] %>
            </div>
          <% end %>

          <!-- Pagination Controls (Top) -->
          <% if @pagy.pages > 1 %>
            <nav aria-label="Paginação de tarefas" class="d-flex justify-content-center mb-3">
              <%= pagy_bootstrap_nav(@pagy).html_safe %>
            </nav>
          <% end %>

          <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
              <thead class="table-dark">
              <tr>
                <th scope="col">Título</th>
                <th scope="col">Status</th>
                <th scope="col">Prioridade</th>
                <th scope="col">Data de Vencimento</th>
                <th scope="col">Responsável</th>
                <th scope="col">Ações</th>
              </tr>
              </thead>
              <tbody>
              <% @tasks.each do |task| %>
                <tr>
                  <td><%= task.title %></td>
                  <td><%= task.status.name %></td>
                  <td><%= task.priority.level %></td>
                  <td><%= task.due_date&.strftime('%d/%m/%Y') %></td>
                  <td><%= task.user&.email || 'Não atribuído' %></td>
                  <td class="d-flex gap-2 flex-wrap">
                    <%= link_to project_task_path(@project, task), class: "btn btn-sm btn-info d-inline-flex align-items-center", aria: { label: "Ver tarefa #{task.title}" } do %>
                      <i class="bi bi-eye me-1"></i> Ver
                    <% end %>
                    <%= link_to edit_project_task_path(@project, task), class: "btn btn-sm btn-warning d-inline-flex align-items-center", aria: { label: "Editar tarefa #{task.title}" } do %>
                      <i class="bi bi-pencil me-1"></i> Editar
                    <% end %>
                    <%= button_to project_task_path(@project, task),
                                  method: :delete,
                                  data: { confirm: 'Tem certeza que deseja excluir esta tarefa?', turbo: false },
                                  form: { class: 'd-inline' },
                                  class: 'btn btn-sm btn-outline-danger d-inline-flex align-items-center',
                                  aria: { label: "Excluir tarefa #{task.title}" } do %>
                      <i class="bi bi-trash me-1"></i> Excluir
                    <% end %>
                  </td>
                </tr>
              <% end %>
              </tbody>
            </table>
          </div>

          <!-- Pagination Controls (Bottom) -->
          <% if @pagy.pages > 1 %>
            <nav aria-label="Paginação de tarefas" class="d-flex justify-content-center mt-3">
              <%= pagy_bootstrap_nav(@pagy).html_safe %>
            </nav>
          <% end %>

          <%= link_to projects_path, class: "btn btn-secondary mt-3 d-inline-flex align-items-center", aria: { label: "Voltar para lista de projetos" } do %>
            <i class="bi bi-arrow-left me-2"></i> Voltar
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
    .btn-primary {
        background-color: #2563eb;
        border-color: #2563eb;
    }
    .btn-primary:hover {
        background-color: #1d4ed8;
        border-color: #1d4ed8;
    }
    .btn-warning {
        background-color: #f59e0b;
        border-color: #f59e0b;
    }
    .btn-warning:hover {
        background-color: #d97706;
        border-color: #d97706;
    }
    .btn-outline-danger {
        border-color: #dc2626;
        color: #dc2626;
    }
    .btn-outline-danger:hover {
        background-color: #dc2626;
        border-color: #dc2626;
        color: #fff;
    }
    .card {
        transition: transform 0.2s ease-in-out;
    }
    .card:hover {
        transform: translateY(-2px);
    }
    .animate__fadeIn {
        animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
</style>